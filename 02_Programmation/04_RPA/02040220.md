## Application aux Bases de Donn√©es
- Cr√©ation d'une base de donn√©es SQLite
- Connexion √† une base de donn√©es.
- Ex√©cution de requ√™tes SQL et manipulation des donn√©es.

::::{exercise}
:label: exo_4_2_2_1
### √âtape 1 : Mise en place des pr√©requis

**Objectif**: Initialiser l'exercice en cr√©ant une base de donn√©es et en installant les modules python n√©cessaires

**Enonc√©**
- Cr√©er une base de donn√©es SQLite vide nomm√©e `test.db`
- Ajouter une table `utilisateurs`.

**Instructions**

1. **Ouvre un terminal** (cmd, PowerShell, Terminal Linux/macOS).
2. Tape la commande suivante pour cr√©er le fichier et entrer dans la console SQLite :
    ```bash
    sqlite3 test.db
    ```
   > Si le fichier `test.db` n‚Äôexiste pas, cette commande le cr√©e automatiquement.

3. Dans la console SQLite, cr√©e la table `utilisateurs` :
   ```sql
   CREATE TABLE users (
       id INTEGER PRIMARY KEY AUTOINCREMENT,
       nom TEXT NOT NULL
   );
   ```

4. V√©rifie que la table est bien cr√©√©e :
   ```sql
   .tables
   ```
   > Tu dois voir la table `utilisateurs` dans la liste.

5. Quitte la console :
   ```sql
   .exit
   ```
:::{warning}
Cette m√©thode n'est valable que pour la cr√©ation d'une base de donn√©es sqlite
:::
6. Installe les modules python
    ```
    pip install robotframework-databaselibrary 
    ```
    :::{note}
    Il n'est pas utile d'installer le module "sqlite". Il est natif. En revanche, il faudra installer le module correspondant
    √† sa base de donn√©es dans un autre cas.
    :::

### √âtape 2 : V√©rification du fichier

:::{literalinclude} code/exo_2_1.robot
:::
### √âtape 3 : Connexion √† la base de donn√©es
**Objectif**: Se connecter √† la base de donn√©es SQLite `test.db` √† l‚Äôaide de la biblioth√®que `DatabaseLibrary`.

**√ânonc√©**
- √âtablir une connexion √† la base de donn√©es `test.db` c
- V√©rifier que la connexion fonctionne, puis la fermer proprement.

**Mots-cl√©s utiles**
- `Connect To Database` : √©tablit la connexion √† la base
- `Disconnect From Database` : ferme la connexion

:::{literalinclude} code/exo_2_2.robot
:::

### √âtape 4 : Ajout de plusieurs utilisateurs

**Objectif**: Ins√©rer plusieurs utilisateurs dans la table `utilisateurs` en utilisant une boucle.

**√ânonc√©**
- Ajouter les utilisateurs suivants dans la base : `Alice`, `Bob`, `Charlie`, `Diana`. 
- Utiliser une boucle pour automatiser l‚Äôinsertion.

**Mots-cl√©s utiles**
- `Create List` : cr√©e une liste de valeurs
- `FOR ... IN ... END` : boucle sur chaque √©l√©ment
- `Execute Sql String` : ex√©cute une requ√™te SQL

:::{literalinclude} code/exo_2_3.robot
:::

::::


## üß© **√âtape 5 : Interrogation et test conditionnel**

### üéØ Objectif
Lire les donn√©es de la table et v√©rifier que certains noms sont bien pr√©sents.

### üìò √ânonc√©
Interroger la table `utilisateurs` pour r√©cup√©rer tous les noms. V√©rifier que `Alice` et `Charlie` sont bien pr√©sents dans les r√©sultats. Utiliser une boucle et une condition pour effectuer cette v√©rification.

```robot
*** Test Cases ***
V√©rification Des Utilisateurs
    Connect To Database    sqlite    ${DBNAME}
    ${result}=    Query    SELECT nom FROM utilisateurs
    ${noms_attendus}=    Create List    Alice    Charlie
    FOR    ${nom_attendu}    IN    @{noms_attendus}
        ${trouv√©}=    Set Variable    False
        FOR    ${row}    IN    @{result}
            ${nom}=    Set Variable    ${row[0]}
            Run Keyword If    '${nom}' == '${nom_attendu}'    Set Variable    ${trouv√©}    True
        END
        Should Be True    ${trouv√©}    msg=Le nom ${nom_attendu} n‚Äôa pas √©t√© trouv√© dans la base.
    END
    Disconnect From Database
```

### üß© Mots-cl√©s utiles
- `Query` : ex√©cute une requ√™te SQL et retourne les r√©sultats
- `Run Keyword If` : ex√©cute une action conditionnelle
- `Should Be True` : v√©rifie qu‚Äôune condition est vraie
