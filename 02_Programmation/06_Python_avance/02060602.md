---
subject: Exercices
title: Aller plus loin avec Python
short_title: Watchdog et Paramiko
authors: 
    - name: Thierry HUET
      affiliations: 
        - APERTO-NOTA
      email: thierry.huet@aperto-nota.fr
date: 2025-05-27
---
## Watchdog et Paramiko

### üê∂ **Watchdog**
**Watchdog** est une biblioth√®que Python qui permet de **surveiller les changements dans un r√©pertoire ou un fichier** en temps r√©el.

#### √Ä quoi √ßa sert ?
- D√©tecter quand un fichier est **cr√©√©**, **modifi√©**, **supprim√©** ou **d√©plac√©**.
- Tr√®s utile pour :
  - automatiser des t√¢ches (ex : traitement automatique de fichiers d√©pos√©s dans un dossier),
  - cr√©er des syst√®mes de surveillance de fichiers,
  - d√©clencher des scripts d√®s qu‚Äôun changement est d√©tect√©.

### üîê **Paramiko**
**Paramiko** est une biblioth√®que Python qui permet de **se connecter √† un serveur distant via SSH**.

#### √Ä quoi √ßa sert ?
- Ex√©cuter des **commandes √† distance** sur un serveur Linux.
- **Transf√©rer des fichiers** entre ta machine et un serveur (via SFTP).
- Tr√®s utilis√© pour :
  - automatiser des d√©ploiements,
  - faire des sauvegardes distantes,
  - g√©rer des serveurs sans interface graphique.

### Installation

```bash
pip install watchdog paramiko
```

### Exercice

:::{exercise} 
:label: exo_6_6_2

Objectif : T√©l√©charger un fichier depuis un serveur distant avec Paramiko et surveiller un r√©pertoire local avec Watchdog.

Instructions

√âtablis une connexion SSH avec un serveur distant √† l‚Äôaide de Paramiko.
T√©l√©charge un fichier sp√©cifique depuis ce serveur vers un r√©pertoire local.
Utilise Watchdog pour surveiller ce r√©pertoire local.
Affiche un message dans la console chaque fois que le fichier est modifi√© ou remplac√©.
:::

:::{solution} exo_6_6_2
:label: sol_6_6_2
:class: dropdown

```python
import time
import paramiko
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler
import os

# Configuration
remote_file_path = "/home/tempo/requirements.txt"
local_directory = "./"
local_file_path = os.path.join(local_directory, "toto.txt")
hostname = "aperto-nota.fr"
port = 22
username = "tempo"
password = "usertempo"

# T√©l√©chargement du fichier via SSH
def telecharger_fichier():
    try:
        transport = paramiko.Transport((hostname, port))
        transport.connect(username=username, password=password)
        sftp = paramiko.SFTPClient.from_transport(transport)

        sftp.get(remote_file_path, local_file_path)

        sftp.close()
        transport.close()
        print("Fichier t√©l√©charg√© avec succ√®s.")
    except Exception as e:
        print(f"Erreur lors du t√©l√©chargement : {e}")

# Surveillance du fichier local
class SurveillanceHandler(FileSystemEventHandler):
    def on_modified(self, event):
        if event.src_path == local_file_path:
            print(f"Le fichier {event.src_path} a √©t√© modifi√©.")

if __name__ == "__main__":
    telecharger_fichier()

    event_handler = SurveillanceHandler()
    observer = Observer()
    observer.schedule(event_handler, path=local_directory, recursive=False)
    observer.start()
    print("Surveillance du fichier en cours...")

    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        observer.stop()
    observer.join()
```

:::